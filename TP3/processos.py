#!/usr/bin/env python
# coding: utf-8

# In[ ]:


#imports 
import socket
import time
from threading import Thread
import random 

#Definindo o endereço do servidos dos 2 sockets
serverAddressPort   = ("127.0.0.1", 20001)
serverAddressPort2   = ("127.0.0.2", 20002)

bufferSize          = 1024

 

# Create a UDP socket at client side

UDPClientSocket = socket.socket(family=socket.AF_INET, type=socket.SOCK_DGRAM)

#função onde os processos vão enviar as mensagens para o coordenador  
def send(id):
    msgRequest       = "1|"+id+"|000000"
    #definindo mensagem de request para ser enviada
    bytesToSend  = str.encode(msgRequest)
    # Send to server using created UDP socket
    #loop que vai de 0 a r, que é o número de vezes que o processo vai mandar o request
    for i in range(0,3):
	#envio do request para o coordenador
        UDPClientSocket.sendto(bytesToSend, serverAddressPort)
        #Recebimento da mensagem de grant
        msgFromServer = UDPClientSocket.recvfrom(bufferSize)
        #escrita no arquivo (so 1 processo por vez)
        if msgFromServer[0].decode("utf-8")[0]=="2":
            arquivo = open('resultado.txt', 'a')
            actualTime = time.strftime('%H:%M:%S \n', time.localtime())
            arquivo.write(id)
            arquivo.write(": ")
            arquivo.write(actualTime)
            arquivo.close()
            msgRelease = "3|"+id+"|000000"
            #enviando RELEASE para coordenador
            bytesToSendRelease = str.encode(msgRelease)
            time.sleep(2)
            UDPClientSocket.sendto(bytesToSendRelease, serverAddressPort2)


T1 = Thread(target=send,args=["1"])
T2 = Thread(target=send,args=["2"])
#T3 = Thread(target=send,args=["3"])
#T4 = Thread(target=send,args=["4"])
#T5 = Thread(target=send,args=["5"])
#T6 = Thread(target=send,args=["6"])
#T7 = Thread(target=send,args=["7"])
#T8 = Thread(target=send,args=["8"])
#T9 = Thread(target=send,args=["9"])
#T10 = Thread(target=send,args=["10"])
#T11 = Thread(target=send,args=["11"])
#T12 = Thread(target=send,args=["12"])
#T13 = Thread(target=send,args=["13"])
#T14 = Thread(target=send,args=["14"])
#T15 = Thread(target=send,args=["15"])
#T16 = Thread(target=send,args=["16"])
#T17 = Thread(target=send,args=["17"])
#T18 = Thread(target=send,args=["18"])
#T19 = Thread(target=send,args=["19"])
#T20 = Thread(target=send,args=["20"])
#T21 = Thread(target=send,args=["21"])
#T22 = Thread(target=send,args=["22"])
#T23 = Thread(target=send,args=["23"])
#T24 = Thread(target=send,args=["24"])
#T25 = Thread(target=send,args=["25"])
#T26 = Thread(target=send,args=["26"])
#T27 = Thread(target=send,args=["27"])
#T28 = Thread(target=send,args=["28"])
#T29 = Thread(target=send,args=["29"])
#T30 = Thread(target=send,args=["30"])
#T31 = Thread(target=send,args=["31"])
#T32 = Thread(target=send,args=["32"])
#T33 = Thread(target=send,args=["33"])
#T34 = Thread(target=send,args=["34"])
#T35 = Thread(target=send,args=["35"])
#T36 = Thread(target=send,args=["36"])
#T37 = Thread(target=send,args=["37"])
#T38 = Thread(target=send,args=["38"])
#T39 = Thread(target=send,args=["39"])
#T40 = Thread(target=send,args=["40"])
#T41 = Thread(target=send,args=["41"])
#T42 = Thread(target=send,args=["42"])
#T43 = Thread(target=send,args=["43"])
#T44 = Thread(target=send,args=["44"])
#T45 = Thread(target=send,args=["45"])
#T46 = Thread(target=send,args=["46"])
#T47 = Thread(target=send,args=["47"])
#T48 = Thread(target=send,args=["48"])
#T49 = Thread(target=send,args=["49"])
#T50 = Thread(target=send,args=["50"])
#T51 = Thread(target=send,args=["51"])
#T52 = Thread(target=send,args=["52"])
#T53 = Thread(target=send,args=["53"])
#T54 = Thread(target=send,args=["54"])
#T55 = Thread(target=send,args=["55"])
#T56 = Thread(target=send,args=["56"])
#T57 = Thread(target=send,args=["57"])
#T58 = Thread(target=send,args=["58"])
#T59 = Thread(target=send,args=["59"])
#T60 = Thread(target=send,args=["60"])
#T61 = Thread(target=send,args=["61"])
#T62 = Thread(target=send,args=["62"])
#T63 = Thread(target=send,args=["63"])
#T64 = Thread(target=send,args=["64"])
#T65 = Thread(target=send,args=["65"])
#T66 = Thread(target=send,args=["66"])
#T67 = Thread(target=send,args=["67"])
#T68 = Thread(target=send,args=["68"])
#T69 = Thread(target=send,args=["69"])
#T70 = Thread(target=send,args=["70"])
#T71 = Thread(target=send,args=["71"])
#T72 = Thread(target=send,args=["72"])
#T73 = Thread(target=send,args=["73"])
#T74 = Thread(target=send,args=["74"])
#T75 = Thread(target=send,args=["75"])
#T76 = Thread(target=send,args=["76"])
#T77 = Thread(target=send,args=["77"])
#T78 = Thread(target=send,args=["78"])
#T79 = Thread(target=send,args=["79"])
#T80 = Thread(target=send,args=["80"])
#T81 = Thread(target=send,args=["81"])
#T82 = Thread(target=send,args=["82"])
#T83 = Thread(target=send,args=["83"])
#T84 = Thread(target=send,args=["84"])
#T85 = Thread(target=send,args=["85"])
#T86 = Thread(target=send,args=["86"])
#T87 = Thread(target=send,args=["87"])
#T88 = Thread(target=send,args=["88"])
#T89 = Thread(target=send,args=["89"])
#T90 = Thread(target=send,args=["90"])
#T91 = Thread(target=send,args=["91"])
#T92 = Thread(target=send,args=["92"])
#T93 = Thread(target=send,args=["93"])
#T94 = Thread(target=send,args=["94"])
#T95 = Thread(target=send,args=["95"])
#T96 = Thread(target=send,args=["96"])
#T97 = Thread(target=send,args=["97"])
#T98 = Thread(target=send,args=["98"])
#T99 = Thread(target=send,args=["99"])
#T100 = Thread(target=send,args=["100"])
#T101 = Thread(target=send,args=["101"])
#T102 = Thread(target=send,args=["102"])
#T103 = Thread(target=send,args=["103"])
#T104 = Thread(target=send,args=["104"])
#T105 = Thread(target=send,args=["105"])
#T106 = Thread(target=send,args=["106"])
#T107 = Thread(target=send,args=["107"])
#T108 = Thread(target=send,args=["108"])
#T109 = Thread(target=send,args=["109"])
#T110 = Thread(target=send,args=["110"])
#T111 = Thread(target=send,args=["111"])
#T112 = Thread(target=send,args=["112"])
#T113 = Thread(target=send,args=["113"])
#T114 = Thread(target=send,args=["114"])
#T115 = Thread(target=send,args=["115"])
#T116 = Thread(target=send,args=["116"])
#T117 = Thread(target=send,args=["117"])
#T118 = Thread(target=send,args=["118"])
#T119 = Thread(target=send,args=["119"])
#T120 = Thread(target=send,args=["120"])
#T121 = Thread(target=send,args=["121"])
#T122 = Thread(target=send,args=["122"])
#T123 = Thread(target=send,args=["123"])
#T124 = Thread(target=send,args=["124"])
#T125 = Thread(target=send,args=["125"])
#T126 = Thread(target=send,args=["126"])
#T127 = Thread(target=send,args=["127"])
#T128 = Thread(target=send,args=["128"])

T1.start()
T2.start()
#T3.start()
#T4.start()
#T5.start()
#T6.start()
#T7.start()
#T8.start()
#T9.start()
#T10.start()
#T11.start()
#T12.start()
#T13.start()
#T14.start()
#T15.start()
#T16.start()

#T17.start()
#T18.start()
#T19.start()
#T20.start()
#T21.start()
#T22.start()
#T23.start()
#T24.start()
#T25.start()
#T26.start()
#T27.start()
#T28.start()
#T29.start()
#T30.start()
#T31.start()
#T32.start()

#T33.start()
#T34.start()
#T35.start()
#T36.start()
#T37.start()
#T38.start()
#T39.start()
#T40.start()
#T41.start()
#T42.start()
#T43.start()
#T44.start()
#T45.start()
#T46.start()
#T47.start()
#T48.start()

#T49.start()
#T50.start()
#T51.start()
#T52.start()
#T53.start()
#T54.start()
#T55.start()
#T56.start()
#T57.start()
#T58.start()
#T59.start()
#T60.start()
#T61.start()
#T62.start()
#T63.start()
#T64.start()

#T65.start()
#T66.start()
#T67.start()
#T68.start()
#T69.start()
#T70.start()
#T71.start()
#T72.start()
#T73.start()
#T74.start()
#T75.start()
#T76.start()
#T77.start()
#T78.start()
#T79.start()
#T80.start()

#T81.start()
#T82.start()
#T83.start()
#T84.start()
#T85.start()
#T86.start()
#T87.start()
#T88.start()
#T89.start()
#T90.start()
#T91.start()
#T92.start()
#T93.start()
#T94.start()
#T95.start()
#T96.start()

#T97.start()
#T98.start()
#T99.start()
#T100.start()
#T101.start()
#T102.start()
#T103.start()
#T104.start()
#T105.start()
#T106.start()
#T107.start()
#T108.start()
#T109.start()
#T110.start()
#T111.start()
#T112.start()

#T113.start()
#T114.start()
#T115.start()
#T116.start()
#T117.start()
#T118.start()
#T119.start()
#T120.start()
#T121.start()
#T122.start()
#T123.start()
#T124.start()
#T125.start()
#T126.start()
#T127.start()
#T128.start()

# In[ ]:




